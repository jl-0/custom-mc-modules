{
  "name": "marketplace-demo",
  "version": "1.0.0",
  "displayName": "Unity Marketplace Demo Application",
  "description": "Example marketplace application showcasing Unity S3 modules for secure, scalable storage",
  "deploymentName": "marketplace-demo-dev",
  "variables": {
    "environment": "dev",
    "region": "us-west-2",
    "project_name": "marketplace-demo",
    "owner": "marketplace-team"
  },
  "moduleReferences": [
    {
      "name": "unity-s3",
      "version": "latest",
      "alias": "user_uploads_bucket",
      "description": "S3 bucket for user-uploaded content with versioning and lifecycle management",
      "config": {
        "bucket_name": "unity-marketplace-user-uploads-dev",
        "environment": "dev",
        "project": "marketplace-demo",
        "versioning_enabled": true,
        "encryption_enabled": true,
        "block_public_access": true,
        "enable_standard_lifecycle": true,
        "standard_lifecycle_config": {
          "transition_to_ia_days": 30,
          "transition_to_glacier_days": 90,
          "expire_days": 365,
          "expire_noncurrent_days": 30
        },
        "enable_access_monitoring": true,
        "logging_enabled": true,
        "access_log_prefix": "user-uploads-access-logs/",
        "notifications": {
          "virus_scan_trigger": {
            "type": "lambda",
            "destination_arn": "arn:aws:lambda:us-west-2:123456789012:function:virus-scanner",
            "events": ["s3:ObjectCreated:*"],
            "filter_prefix": "uploads/"
          }
        },
        "tags": {
          "Purpose": "UserUploads",
          "DataClassification": "Internal",
          "Owner": "marketplace-team",
          "CostCenter": "engineering",
          "Backup": "required"
        }
      }
    },
    {
      "name": "unity-s3",
      "version": "latest",
      "alias": "marketplace_data_bucket",
      "description": "S3 bucket for marketplace product data and metadata with cross-region replication",
      "config": {
        "bucket_name": "unity-marketplace-data-dev",
        "environment": "dev",
        "project": "marketplace-demo",
        "versioning_enabled": true,
        "encryption_enabled": true,
        "block_public_access": true,
        "lifecycle_rules": [
          {
            "id": "marketplace-data-lifecycle",
            "enabled": true,
            "filter": {
              "prefix": "product-data/"
            },
            "transitions": [
              {
                "days": 60,
                "storage_class": "STANDARD_IA"
              },
              {
                "days": 180,
                "storage_class": "GLACIER"
              }
            ],
            "noncurrent_version_transitions": [
              {
                "days": 30,
                "storage_class": "STANDARD_IA"
              }
            ],
            "noncurrent_version_expiration": {
              "days": 90
            }
          }
        ],
        "enable_access_monitoring": true,
        "logging_enabled": true,
        "access_log_prefix": "marketplace-data-access-logs/",
        "replication_configuration": {
          "role": "arn:aws:iam::123456789012:role/replication-role",
          "rules": [
            {
              "id": "replicate-to-backup-region",
              "status": "Enabled",
              "destination": {
                "bucket": "arn:aws:s3:::unity-marketplace-data-backup-us-east-1",
                "storage_class": "STANDARD_IA"
              }
            }
          ]
        },
        "tags": {
          "Purpose": "MarketplaceData",
          "DataClassification": "Confidential", 
          "Owner": "marketplace-team",
          "CostCenter": "engineering",
          "Backup": "required",
          "Replication": "enabled"
        }
      }
    },
    {
      "name": "unity-s3",
      "version": "latest", 
      "alias": "static_assets_bucket",
      "description": "S3 bucket for static website assets with public read access and CDN optimization",
      "config": {
        "bucket_name": "unity-marketplace-static-dev",
        "environment": "dev",
        "project": "marketplace-demo",
        "versioning_enabled": false,
        "encryption_enabled": true,
        "block_public_access": false,
        "website_configuration": {
          "index_document": "index.html",
          "error_document": "error.html"
        },
        "cors_rules": [
          {
            "allowed_methods": ["GET", "HEAD"],
            "allowed_origins": ["*"],
            "allowed_headers": ["*"],
            "expose_headers": ["ETag"],
            "max_age_seconds": 3000
          }
        ],
        "lifecycle_rules": [
          {
            "id": "static-assets-lifecycle",
            "enabled": true,
            "filter": {
              "prefix": "assets/"
            },
            "transitions": [
              {
                "days": 90,
                "storage_class": "STANDARD_IA"
              }
            ]
          }
        ],
        "bucket_policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"PublicReadGetObject\",\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"s3:GetObject\",\n      \"Resource\": \"arn:aws:s3:::unity-marketplace-static-dev/*\"\n    }\n  ]\n}",
        "transfer_acceleration_enabled": true,
        "tags": {
          "Purpose": "StaticAssets",
          "DataClassification": "Public",
          "Owner": "marketplace-team",
          "CostCenter": "engineering",
          "CDN": "enabled"
        }
      }
    }
  ],
  "postDeploymentActions": [
    {
      "name": "configure_bucket_notifications",
      "description": "Set up S3 event notifications for data processing pipelines",
      "type": "script",
      "script": "scripts/configure-notifications.sh"
    },
    {
      "name": "create_cloudfront_distribution",
      "description": "Create CloudFront distribution for static assets bucket",
      "type": "terraform",
      "config": "post-deployment/cloudfront.tf"
    },
    {
      "name": "setup_monitoring_dashboard",
      "description": "Create CloudWatch dashboard for marketplace metrics",
      "type": "cloudformation",
      "template": "monitoring/dashboard.yaml"
    }
  ],
  "outputs": {
    "user_uploads_bucket_name": "${module.user_uploads_bucket.bucket_id}",
    "user_uploads_bucket_arn": "${module.user_uploads_bucket.bucket_arn}",
    "user_uploads_console_url": "${module.user_uploads_bucket.console_url}",
    "marketplace_data_bucket_name": "${module.marketplace_data_bucket.bucket_id}",
    "marketplace_data_bucket_arn": "${module.marketplace_data_bucket.bucket_arn}",
    "marketplace_data_console_url": "${module.marketplace_data_bucket.console_url}",
    "static_assets_bucket_name": "${module.static_assets_bucket.bucket_id}",
    "static_assets_bucket_arn": "${module.static_assets_bucket.bucket_arn}",
    "static_assets_website_url": "${module.static_assets_bucket.bucket_website_endpoint}",
    "static_assets_console_url": "${module.static_assets_bucket.console_url}"
  },
  "metadata": {
    "author": "Unity Marketplace Team",
    "created": "2025-07-01",
    "unity_version": ">=1.0.0",
    "terraform_version": ">=1.0",
    "aws_provider_version": ">=4.0",
    "estimated_monthly_cost": "$50-100 USD (depending on usage)",
    "deployment_time": "5-10 minutes",
    "maintenance_level": "low"
  }
}